<% content_for :page_title, "Dashboard" %>

<div class="page-header">
  <h2 class="page-header__title">Dashboard</h2>
  <p class="page-header__description">Welcome to CommsHub - Your central communication management system</p>
  <div class="page-header__actions">
    <%= link_to "Create Announcement", new_announcement_path, class: "btn btn-primary" %>
  </div>
</div>

<div class="card">
  <div class="card__header">
    <h3 class="card__title">Quick Stats</h3>
  </div>

  <div class="grid-auto-fit-200">
    <div class="stat-card stat-card--blue">
      <div class="stat-card__value text-blue"><%= Announcement.count %></div>
      <div class="stat-card__label">Total Announcements</div>
    </div>

    <div class="stat-card stat-card--green">
      <div class="stat-card__value text-success"><%= Announcement.where(status: 'delivered').count %></div>
      <div class="stat-card__label">Delivered</div>
    </div>

    <div class="stat-card stat-card--orange">
      <div class="stat-card__value text-warning"><%= Announcement.where(status: 'pending').count %></div>
      <div class="stat-card__label">Pending</div>
    </div>

    <div class="stat-card stat-card--info">
      <div class="stat-card__value text-info"><%= Audience.count %></div>
      <div class="stat-card__label">Audiences</div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card__header">
    <h3 class="card__title">Recent Announcements</h3>
  </div>

  <% if Announcement.any? %>
    <table class="table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Audience</th>
          <th>Status</th>
          <th>Delivery Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% Announcement.order(created_at: :desc).limit(5).each do |announcement| %>
          <tr>
            <td><strong><%= announcement.title %></strong></td>
            <td><%= announcement.audience&.name || "N/A" %></td>
            <td>
              <% if announcement.status == 'delivered' %>
                <span class="badge badge-success">Delivered</span>
              <% elsif announcement.status == 'pending' %>
                <span class="badge badge-warning">Pending</span>
              <% elsif announcement.status == 'failed' %>
                <span class="badge badge-danger">Failed</span>
              <% else %>
                <span class="badge badge-info"><%= announcement.status %></span>
              <% end %>
            </td>
            <td><%= announcement.delivery_date ? announcement.delivery_date.strftime("%b %d, %Y") : "Not set" %></td>
            <td>
              <%= link_to "View", announcement_path(announcement), class: "btn btn-secondary btn--xs" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="empty-state">
      <div class="empty-state__icon">ğŸ“¢</div>
      <p>No announcements yet. Create your first announcement to get started!</p>
      <div class="empty-state__actions">
        <%= link_to "Create Announcement", new_announcement_path, class: "btn btn-primary" %>
      </div>
    </div>
  <% end %>
</div>

<div class="card">
  <div class="card__header">
    <h3 class="card__title">Quick Actions</h3>
  </div>

  <div class="grid-auto-fit-250">
    <%= link_to new_announcement_path, class: "settings-card-link" do %>
      <div class="quick-action-card">
        <div class="quick-action-card__icon">ğŸ“</div>
        <div class="quick-action-card__title">Create Announcement</div>
        <div class="quick-action-card__desc">Draft a new communication</div>
      </div>
    <% end %>

    <%= link_to audiences_path, class: "settings-card-link" do %>
      <div class="quick-action-card">
        <div class="quick-action-card__icon">ğŸ‘¥</div>
        <div class="quick-action-card__title">Manage Audiences</div>
        <div class="quick-action-card__desc">Configure recipient groups</div>
      </div>
    <% end %>

    <%= link_to announcements_path, class: "settings-card-link" do %>
      <div class="quick-action-card">
        <div class="quick-action-card__icon">ğŸ“Š</div>
        <div class="quick-action-card__title">View All Announcements</div>
        <div class="quick-action-card__desc">See complete history</div>
      </div>
    <% end %>
  </div>
</div>
