<div class="show-container">
  <div class="show-breadcrumb">
    <%= link_to "Back to Announcements", announcements_path %>
  </div>

  <!-- Header Section -->
  <div class="announcement-hero">
    <div class="announcement-hero__top">
      <h1 class="announcement-hero__title"><%= @announcement.title %></h1>
      <span class="announcement-hero__badge"><%= @announcement.status %></span>
    </div>
    <div class="announcement-hero__meta">
      <span>Created <%= @announcement.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
      <% if @announcement.scheduled_for.present? %>
        <span>Scheduled for <%= @announcement.scheduled_for.strftime("%B %d, %Y at %I:%M %p") %></span>
      <% end %>
      <span><%= @announcement.audiences.count %> <%= 'audience'.pluralize(@announcement.audiences.count) %></span>
    </div>
  </div>

  <!-- Messages Card -->
  <div class="show-card">
    <div class="show-card-header">
      <div class="show-card-header__icon">ğŸ“</div>
      <h2 class="show-card-header__title">Messages</h2>
    </div>

    <div class="message-content">
      <h3>Base Message</h3>
      <p><%= @announcement.base_body %></p>
    </div>

    <% if @announcement.email_body.present? %>
      <div class="message-content">
        <h3>Email Version</h3>
        <p><%= @announcement.email_body %></p>
      </div>
    <% end %>

    <% if @announcement.slack_body.present? %>
      <div class="message-content">
        <h3>Slack Version</h3>
        <p><%= @announcement.slack_body %></p>
      </div>
    <% end %>

    <% if @announcement.whatsapp_body.present? %>
      <div class="message-content">
        <h3>WhatsApp Version</h3>
        <p><%= @announcement.whatsapp_body %></p>
      </div>
    <% end %>
  </div>

  <!-- Channels Card -->
  <div class="show-card">
    <div class="show-card-header">
      <div class="show-card-header__icon">ğŸ“±</div>
      <h2 class="show-card-header__title">Delivery Channels</h2>
    </div>

    <div class="channels-grid">
      <div class="channel-card <%= 'active' if @announcement.send_to_slack %>">
        <div class="icon">ğŸ’¬</div>
        <div class="label">Slack</div>
      </div>

      <div class="channel-card <%= 'active' if @announcement.send_to_email %>">
        <div class="icon">ğŸ“§</div>
        <div class="label">Email</div>
      </div>

      <div class="channel-card <%= 'active' if @announcement.send_to_whatsapp %>">
        <div class="icon">ğŸ“²</div>
        <div class="label">WhatsApp</div>
      </div>
    </div>
  </div>

  <!-- Target Audiences Card -->
  <% if @announcement.audiences.any? %>
    <div class="show-card">
      <div class="show-card-header">
        <div class="show-card-header__icon">ğŸ‘¥</div>
        <h2 class="show-card-header__title">Target Audiences</h2>
      </div>

      <div class="audiences-list">
        <% @announcement.audiences.each do |audience| %>
          <div class="audience-item">
            <div class="audience-icon">
              <% if audience.type == 'SlackAudience' %>ğŸ’¬
              <% elsif audience.type == 'EmailAudience' %>ğŸ“§
              <% elsif audience.type == 'WhatsappAudience' %>ğŸ“²
              <% end %>
            </div>
            <div class="audience-info">
              <p class="audience-name"><%= audience.name %></p>
              <p class="audience-detail">
                <% if audience.type == 'SlackAudience' %>
                  <%= audience.slack_channel %>
                <% elsif audience.type == 'EmailAudience' %>
                  <%= audience.email_list.count %> recipients
                <% elsif audience.type == 'WhatsappAudience' %>
                  <%= audience.whatsapp_list.count %> contacts
                <% end %>
              </p>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Delivery Logs Card -->
  <% if @announcement.delivery_logs.any? %>
    <div class="show-card">
      <div class="show-card-header">
        <div class="show-card-header__icon">ğŸ“Š</div>
        <h2 class="show-card-header__title">Delivery Logs</h2>
      </div>

      <div class="delivery-logs">
        <% @announcement.delivery_logs.order(created_at: :desc).each do |log| %>
          <div class="log-item">
            <div class="log-status <%= log.status %>"></div>
            <div class="log-info">
              <div class="log-channel"><%= log.channel.capitalize %> â†’ <%= log.destination %></div>
              <div class="log-detail">
                <%= log.status.capitalize %> Â· <%= log.created_at.strftime("%b %d at %I:%M %p") %>
                <% if log.details.present? %>
                  Â· <%= log.details %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Actions Card -->
  <div class="show-card">
    <div class="show-card-header">
      <div class="show-card-header__icon">âš¡</div>
      <h2 class="show-card-header__title">Actions</h2>
    </div>

    <% if @announcement.status == 'draft' %>
      <div class="action-buttons mb-16">
        <%= link_to "Edit Draft", edit_announcement_path(@announcement), class: "btn btn-secondary" %>
      </div>

      <hr class="show-divider">

      <h3 class="show-section-heading">Schedule for Later</h3>
      <%= form_with url: schedule_announcement_path(@announcement), method: :patch, data: { turbo: false } do |f| %>
        <div class="schedule-form">
          <div class="form-group">
            <label class="form-label">Select Date & Time</label>
            <%= f.datetime_local_field :scheduled_for, class: "form-input", name: "announcement[scheduled_for]" %>
          </div>
          <%= f.submit "Schedule", class: "btn btn-primary" %>
        </div>
      <% end %>

      <hr class="show-divider">

      <h3 class="show-section-heading">Or Send Immediately</h3>
      <div class="action-buttons">
        <%= button_to "Send Now", send_now_announcement_path(@announcement), method: :patch, class: "btn btn-primary" %>
        <%= link_to "Back to Announcements", announcements_path, class: "btn btn-secondary" %>
      </div>
    <% elsif @announcement.status == 'scheduled' %>
      <div class="action-buttons">
        <%= button_to "Cancel Schedule", cancel_schedule_announcement_path(@announcement), method: :patch, class: "btn btn-danger" %>
        <%= link_to "Back to Announcements", announcements_path, class: "btn btn-secondary" %>
      </div>
    <% else %>
      <div class="action-buttons">
        <% if @announcement.status == 'failed' %>
          <%= link_to "Edit", edit_announcement_path(@announcement), class: "btn btn-secondary" %>
          <%= button_to "Retry", send_now_announcement_path(@announcement), method: :patch, class: "btn btn-primary" %>
        <% end %>
        <%= link_to "Back to Announcements", announcements_path, class: "btn btn-secondary" %>
      </div>
    <% end %>
  </div>
</div>
